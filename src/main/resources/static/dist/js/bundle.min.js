"use strict";function getSelectedList(){var e=[];return $("input[name=list]:checked").each(function(){e.push($(this).val())}),e}angular.module("app",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ngStorage","ui.router","ui.bootstrap","oc.lazyLoad","oitozero.ngSweetAlert"]);var app=angular.module("app");app.factory("httpInterceptor",["$q","$injector",function(e,t){return{responseError:function(s){if(401==s.status){var n=t.get("$rootScope");sessionStorage.removeItem("token"),n.$state.go("signin"),$.notify({message:"<div style='text-align: center'><i class='fa fa-warning'></i> 身份验证异常，请重新登录！</div>"},{type:"danger",placement:{align:"center"}})}return e.reject(s)},response:function(e){return e},request:function(e){var t;return(t=sessionStorage.getItem("token"))&&(e.headers.Authorization=t),e},requestError:function(t){return e.reject(t)}}}]),app.config(["$controllerProvider","$compileProvider","$filterProvider","$provide","$locationProvider","$httpProvider",function(e,t,s,n,a,o){app.controller=e.register,app.directive=t.directive,app.filter=s.register,app.factory=n.factory,app.service=n.service,app.constant=n.constant,app.value=n.value,o.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8",o.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8",o.defaults.transformRequest=function(e){return angular.isObject(e)&&"[object File]"!==String(e)?$.param(e):e},o.interceptors.push("httpInterceptor")}]),app.constant("host",""),app.directive("onFinishRenderFilters",["$timeout",function(e){return{restrict:"A",link:function(t,s,n){!0===t.$last&&e(function(){t.$emit("ngRepeatFinished")})}}}]),app.directive("onRepeatFinish",["$timeout",function(e){return{link:function(t,s,n){t.$last&&e(function(){t.$eval(n.onRepeatFinish)})}}}]),app.config(["$provide",function(e){e.decorator("$exceptionHandler",["$delegate",function(e){return function(t,s){e(t,s),setTimeout(function(){throw t})}}])}]),angular.module("app").run(["$rootScope","$state","$stateParams",function(e,t,s){e.$state=t,e.$stateParams=s}]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/signin"),e.state("signin",{controller:"SigninCtrl",url:"/signin",templateUrl:"static/tpl/signin.html"}).state("app",{controller:"GlobalCtrl",url:"/app",templateUrl:"static/tpl/app.html"}).state("app.admin",{url:"/admin",templateUrl:"static/tpl/admin/admin.html"}).state("app.teacher",{url:"/teacher",templateUrl:"static/tpl/teacher/teacher.html"}).state("app.student",{url:"/student",templateUrl:"static/tpl/student/student.html"}).state("app.teacher.allCourse",{controller:"TeacherAllCourseCtrl",url:"/allCourse",templateUrl:"static/tpl/teacher/all-course.html"}).state("app.teacher.myCourse",{controller:"TeacherMyCourseCtrl",url:"/myCourse",templateUrl:"static/tpl/teacher/my-course.html"}).state("app.student.allCourse",{controller:"StudentAllCourseCtrl",url:"/allCourse",templateUrl:"static/tpl/student/all-course.html"}).state("app.student.myCourse",{controller:"StudentMyCourseCtrl",url:"/myCourse",templateUrl:"static/tpl/student/my-course.html"}).state("app.admin.dept",{controller:"DeptCtrl",url:"/dept",templateUrl:"static/tpl/admin/dept.html"}).state("app.admin.class",{controller:"ClassCtrl",url:"/class",templateUrl:"static/tpl/admin/class.html"}).state("app.admin.teacher",{controller:"TeacherManageCtrl",url:"/teacher",templateUrl:"static/tpl/admin/teacher.html"}).state("app.admin.student",{controller:"StudentManageCtrl",url:"/student",templateUrl:"static/tpl/admin/student.html"}).state("app.admin.course",{controller:"CourseManageCtrl",url:"/course",templateUrl:"static/tpl/admin/course.html"}).state("app.admin.password",{controller:"ChangePwdCtrl",url:"/password",templateUrl:"static/tpl/common/change-pwd.html"}).state("app.teacher.password",{controller:"ChangePwdCtrl",url:"/password",templateUrl:"static/tpl/common/change-pwd.html"}).state("app.student.password",{controller:"ChangePwdCtrl",url:"/password",templateUrl:"static/tpl/common/change-pwd.html"}).state("app.teacher.grade",{controller:"RecordGradeCtrl",url:"/recordGrade/:cid",templateUrl:"static/tpl/teacher/grade.html"}).state("app.student.grade",{controller:"QueryGradeCtrl",url:"/queryGrade/:cid",templateUrl:"static/tpl/student/grade.html"})}]),app.controller("AppCtrl",["$scope","$state",function(e,t){e.app={name:"中国最强-选课管理系统 "},e.$on("$stateChangeStart",function(e,s,n,a,o){"signin"===s.name||sessionStorage.getItem("token")||(e.preventDefault(),t.go("signin"))})}]),app.controller("ChangePwdCtrl",["$scope","$http","host","$timeout","SweetAlert","$state",function(e,t,s,n,a,o){e.submit=function(){e.check=!0,n(function(){$("form .has-error").length>0||t.post(s+"Access/changePwd",{newPwd:e.password,oldPwd:e.oldPwd}).success(function(t){1==t.code?(e.logout(),a.swal("修改成功","修改密码成功，请重新登录。","success"),o.go("signin")):a.swal("修改失败",t.msg,"error")})},100)}}]),app.controller("ClassCtrl",["$scope","$modal","$http","host","$state","SweetAlert","$timeout",function(e,t,s,n,a,o,r){var c=[];s.get(n+"Admin/dept/getAll").success(function(t){1==t.code&&(c=t.data,e.deptMap={},t.data.map(function(t){e.deptMap[t.id]=t.name}))}),s.get(n+"Admin/class/getAll").success(function(t){1==t.code&&(e.classes=t.data),0==t.data.length&&$(".table").dataTable()}),e.add=function(){t.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(e,t){e.depts=c,e.clazz={},e.ok=function(){e.check=!0,r(function(){$("form .has-error").length>0||s.post(n+"Admin/class/add",e.clazz).success(function(s){1==s.code?o.swal("增加成功","新增“"+e.clazz.name+"”","success"):o.swal("增加失败",s.msg,"error"),t.close(),a.reload()})},100)},e.cancel=function(){t.dismiss()}}],size:"md"})},e.del=function(){var t=getSelectedList().map(function(t){return e.classes[t].id});if(0==t.length)return void o.swal("提示","请选择删除的班级","warning");o.swal({title:"提示",text:"是否确定删除选中的班级？",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(e){e&&s.post(n+"Admin/class/del",{ids:t}).success(function(e){1==e.code?(o.swal("删除成功","成功删除选中的班级","success"),a.reload()):o.swal("删除失败",e.msg,"error")})})},e.edit=function(){var r=getSelectedList();if(1!=getSelectedList().length)return void o.swal("提示","请选择一个编辑的班级","warning");var l=r[0],i=e.classes[l];t.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(e,t){e.depts=c,e.clazz=i,e.ok=function(){e.check=!0,e.clazz.name&&e.clazz.deptId&&s.post(n+"Admin/class/upd",e.clazz).success(function(e){1==e.code?(o.swal("编辑成功","","success"),a.reload()):o.swal("编辑失败",e.msg,"error"),t.close(),a.reload()})},e.cancel=function(){t.dismiss()}}],size:"md"})}}]),app.controller("CourseManageCtrl",["$scope","$modal","$http","host","$state","SweetAlert","$timeout",function(e,t,s,n,a,o,r){s.get(n+"Admin/course/getAll").success(function(t){1==t.code&&(e.courses=t.data),0==t.data.length&&$(".table").dataTable()}),e.add=function(){t.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(e,t){e.course={},e.ok=function(){e.check=!0,r(function(){$("form .has-error").length>0||s.post(n+"Admin/course/add",e.course).success(function(s){1==s.code?o.swal("增加成功","新增“"+e.course.name+"”","success"):o.swal("增加失败",s.msg,"error"),t.close(),a.reload()})},100)},e.cancel=function(){t.dismiss()}}],size:"md"})},e.del=function(){var t=getSelectedList().map(function(t){return e.courses[t].id});if(0==t.length)return void o.swal("提示","请选择删除的课程","warning");o.swal({title:"提示",text:"是否确定删除选中的课程？",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(e){e&&s.post(n+"Admin/course/del",{ids:t}).success(function(e){1==e.code?(o.swal("删除成功","成功删除选中的课程","success"),a.reload()):o.swal("删除失败",e.msg,"error")})})},e.edit=function(){var c=getSelectedList();if(1!=getSelectedList().length)return void o.swal("提示","请选择一个编辑的课程","warning");var l=c[0],i=e.courses[l];t.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(e,t){e.course=i,e.ok=function(){e.check=!0,r(function(){$("form .has-error").length>0||s.post(n+"Admin/course/upd",e.course).success(function(e){1==e.code?(o.swal("编辑成功","","success"),a.reload()):o.swal("编辑失败",e.msg,"error"),t.close(),a.reload()})},100)},e.cancel=function(){t.dismiss()}}],size:"md"})}}]),app.controller("DeptCtrl",["$scope","$modal","$http","host","$state","SweetAlert",function(e,t,s,n,a,o){s.get(n+"Admin/dept/getAll").success(function(t){1==t.code&&(e.depts=t.data),0==t.data.length&&$(".table").dataTable()}),e.add=function(){t.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(e,t){e.dept={},e.ok=function(){e.check=!0,e.dept.name&&s.post(n+"Admin/dept/add",e.dept).success(function(s){1==s.code?o.swal("增加成功","新增“"+e.dept.name+"”","success"):o.swal("增加失败",s.msg,"error"),t.close(),a.reload()})},e.cancel=function(){t.dismiss()}}],size:"md"})},e.del=function(){var t=getSelectedList().map(function(t){return e.depts[t].id});if(0==t.length)return void o.swal("提示","请选择删除的院系","warning");o.swal({title:"提示",text:"是否确定删除选中的院系？",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(e){e&&s.post(n+"Admin/dept/del",{ids:t}).success(function(e){1==e.code?(o.swal("删除成功","成功删除选中的院系","success"),a.reload()):o.swal("删除失败",e.msg,"error")})})},e.edit=function(){var r=getSelectedList();if(1!=getSelectedList().length)return void o.swal("提示","请选择一个编辑的院系","warning");var c=r[0],l=e.depts[c];t.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(e,t){e.dept=l,e.ok=function(){e.check=!0,e.dept.name&&s.post(n+"Admin/dept/upd",e.dept).success(function(e){1==e.code?(o.swal("编辑成功","","success"),a.reload()):o.swal("编辑失败",e.msg,"error"),t.close(),a.reload()})},e.cancel=function(){t.dismiss()}}],size:"md"})}}]),app.controller("GlobalCtrl",["$scope","$state",function(e,t){e.reload=function(){t.reload()},e.curState=function(){return t.current.name},e.renderTable=function(){$(".table").dataTable()},e.logout=function(){sessionStorage.removeItem("token"),sessionStorage.removeItem("userID"),sessionStorage.removeItem("role")}}]),app.controller("QueryGradeCtrl",["$scope","$http","host",function(e,t,s){t.get(s+"Student/grade/queryGrade").success(function(t){1==t.code&&(e.gradeMap={},t.data.grades.map(function(t){e.gradeMap[t.cid]=t.grade}),e.courses=t.data.courses.map(function(t){return t.grade=e.gradeMap[t.id],t.grade<45?t.status="重修":t.grade<60?t.status="补考":t.grade<70?t.status="及格":t.grade<85?t.status="良好":t.status="优秀",t})),0==e.courses.length&&$(".table").dataTable()})}]),app.controller("RecordGradeCtrl",["$scope","$stateParams","$http","host","SweetAlert",function(e,t,s,n,a){var o=t.cid;s.get(n+"Teacher/grade/findStudentsByCid?id="+o).success(function(t){1==t.code&&(e.course=t.data.course,e.students=t.data.students),0==e.students.length&&$(".table").dataTable()}),s.get(n+"Teacher/class/getAll").success(function(t){1==t.code&&(e.classesMap={},t.data.map(function(t){e.classesMap[t.id]=t.name}))}),s.get(n+"Teacher/class/getGradeByCid?id="+o).success(function(t){1==t.code&&(e.gradeMap={},t.data.map(function(t){e.gradeMap[t.sid]=t.grade}))}),e.record=function(t,r){var c=$(t.target).val();if(0!=c.length)return isNaN(c)||c<1||c>100?void $.notify({message:"<i class='fa fa-warning'></i> 请输入1~100的分数！"},{type:"warning"}):void s.post(n+"Teacher/grade/recordGrade",{cid:o,sid:r,grade:c}).success(function(t){1==t.code?e.gradeMap[r]=c:a.swal("登记成绩失败",t.msg,"error")})},e.edit=function(){getSelectedList().map(function(t){e.gradeMap[e.students[t].id]=0})}}]),app.controller("SigninCtrl",["$scope","$state","host","SweetAlert","$http",function(e,t,s,n,a){e.user=localStorage.user?JSON.parse(localStorage.user):{role:"student"},e.submit=function(){a.post(s+"Access/signin",e.user).success(function(s){1==s.code?(sessionStorage.token=s.data.token,"student"==s.data.role?t.go("app.student"):"teacher"==s.data.role?t.go("app.teacher"):"admin"==s.data.role&&t.go("app.admin"),$("#remember").prop("checked")?localStorage.user=JSON.stringify({name:e.user.name,role:e.user.role}):localStorage.removeItem("user"),n.swal("登录成功","欢迎登录，"+s.data.name,"success")):n.swal("登录失败",s.msg,"error")}).error(function(){n.swal("提示","服务器异常","error")})}}]),app.controller("StudentAllCourseCtrl",["$scope","$http","host","SweetAlert",function(e,t,s,n){t.get(s+"Student/course/getAll").success(function(t){1==t.code&&(e.courses=t.data.courses,e.teachers={},e.tc={},t.data.teachers.map(function(t){e.teachers[t.id]=t.name}),t.data.tc.map(function(t){e.tc[t.cid]=t.tid})),0==t.data.courses.length&&$(".table").dataTable()}),e.select=function(){var a=getSelectedList().map(function(t){return e.courses[t].id});if(0==a.length)return void n.swal("提示","请选择课程","warning");n.swal({title:"提示",text:"请再次确认您的选课信息！",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(e){e&&t.post(s+"Student/course/selectCourses",{ids:a}).success(function(e){1==e.code?n.swal("选课成功","请到“我的选课”中查看您的选课","success"):n.swal("选课失败",e.msg,"error")})})}}]),app.controller("StudentManageCtrl",["$scope","$modal","$http","host","$state","SweetAlert","$timeout",function(e,t,s,n,a,o,r){var c=[];s.get(n+"Admin/dept/getAll").success(function(t){1==t.code&&(c=t.data,e.deptMap={},t.data.map(function(t){e.deptMap[t.id]=t.name}))});var l={};s.get(n+"Admin/class/getAll").success(function(t){1==t.code&&(t.data.map(function(e){l[e.deptId]||(l[e.deptId]=[]),l[e.deptId].push(e)}),e.classesMap={},t.data.map(function(t){e.classesMap[t.id]=t.name}))}),s.get(n+"Admin/student/getAll").success(function(t){1==t.code&&(e.students=t.data),0==t.data.length&&$(".table").dataTable()}),e.add=function(){t.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(e,t){e.depts=c,e.classMap=l,e.student={},e.changeDept=function(){delete e.student.classId},e.ok=function(){e.check=!0,r(function(){$("form .has-error").length>0||s.post(n+"Admin/student/add",e.student).success(function(s){1==s.code?o.swal("增加成功","新增“"+e.student.name+"”","success"):o.swal("增加失败",s.msg,"error"),t.close(),a.reload()})},100)},e.cancel=function(){t.dismiss()}}],size:"md"})},e.del=function(){var t=getSelectedList().map(function(t){return e.students[t].id});if(0==t.length)return void o.swal("提示","请选择删除的学生","warning");o.swal({title:"提示",text:"是否确定删除选中的学生？",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(e){e&&s.post(n+"Admin/student/del",{ids:t}).success(function(e){1==e.code?(o.swal("删除成功","成功删除选中的学生","success"),a.reload()):o.swal("删除失败",e.msg,"error")})})},e.edit=function(){var i=getSelectedList();if(1!=getSelectedList().length)return void o.swal("提示","请选择一个编辑的学生","warning");var d=i[0],u=e.students[d];t.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(e,t){e.depts=c,e.classMap=l,e.student=u,delete e.student.password,e.changeDept=function(){delete e.student.classId},e.ok=function(){e.check=!0,r(function(){$("form .has-error").length>0||s.post(n+"Admin/student/upd",e.student).success(function(e){1==e.code?(o.swal("编辑成功","","success"),a.reload()):o.swal("编辑失败",e.msg,"error"),t.close()})},100)},e.cancel=function(){t.dismiss()}}],size:"md"})}}]),app.controller("StudentMyCourseCtrl",["$scope","$http","host","SweetAlert","$state",function(e,t,s,n,a){t.get(s+"Student/course/selectedCourses").success(function(t){1==t.code&&(e.courses=t.data.courses,e.teachers={},e.tc={},t.data.teachers.map(function(t){e.teachers[t.id]=t.name}),t.data.tc.map(function(t){e.tc[t.cid]=t.tid})),0==t.data.courses.length&&$(".table").dataTable()}),e.unselect=function(){var o=getSelectedList().map(function(t){return e.courses[t].id});if(0==o.length)return void n.swal("提示","请选择退选的课程","warning");n.swal({title:"提示",text:"是否退选选中的课程！",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(e){e&&t.post(s+"Student/course/unselectCourses",{ids:o}).success(function(e){1==e.code?(n.swal("退选成功","","success"),a.reload()):n.swal("退选失败","","error")})})}}]),app.controller("TeacherAllCourseCtrl",["$scope","$http","host","SweetAlert",function(e,t,s,n){t.get(s+"Teacher/course/getAll").success(function(t){1==t.code&&(e.courses=t.data),0==t.data.length&&$(".table").dataTable()}),e.select=function(){var a=getSelectedList().map(function(t){return e.courses[t].id});if(0==a.length)return void n.swal("提示","请选择授课的课程","warning");n.swal({title:"提示",text:"请再次确认您的授课信息！",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(o){o&&t.post(s+"Teacher/course/selectCourses",{ids:a}).success(function(t){1==t.code?(n.swal("选择授课成功","请到“我的授课”中查看您的授课","success"),e.reload()):n.swal("选择授课失败",t.msg,"error")})})}}]),app.controller("TeacherManageCtrl",["$scope","$modal","$http","host","$state","SweetAlert","$timeout",function(e,t,s,n,a,o,r){var c=[];s.get(n+"Admin/dept/getAll").success(function(t){1==t.code&&(c=t.data,e.deptMap={},t.data.map(function(t){e.deptMap[t.id]=t.name}))}),s.get(n+"Admin/teacher/getAll").success(function(t){1==t.code&&(e.teachers=t.data),0==t.data.length&&$(".table").dataTable()}),e.add=function(){t.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(e,t){e.depts=c,e.teacher={},e.ok=function(){e.check=!0,r(function(){$("form .has-error").length>0||s.post(n+"Admin/teacher/add",e.teacher).success(function(s){1==s.code?o.swal("增加成功","新增“"+e.teacher.name+"”","success"):o.swal("增加失败",s.msg,"error"),t.close(),a.reload()})},100)},e.cancel=function(){t.dismiss()}}],size:"md"})},e.del=function(){var t=getSelectedList().map(function(t){return e.teachers[t].id});if(0==t.length)return void o.swal("提示","请选择删除的教职工","warning");o.swal({title:"提示",text:"是否确定删除选中的教职工？",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(e){e&&s.post(n+"Admin/teacher/del",{ids:t}).success(function(e){1==e.code?(o.swal("删除成功","成功删除选中的教职工","success"),a.reload()):o.swal("删除失败",e.msg,"error")})})},e.edit=function(){var l=getSelectedList();if(1!=getSelectedList().length)return void o.swal("提示","请选择一个编辑的教职工","warning");var i=l[0],d=e.teachers[i];t.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(e,t){e.depts=c,e.teacher=d,delete e.teacher.password,e.ok=function(){e.check=!0,r(function(){$("form .has-error").length>0||s.post(n+"Admin/teacher/upd",e.teacher).success(function(e){1==e.code?(o.swal("编辑成功","","success"),a.reload()):o.swal("编辑失败",e.msg,"error"),t.close()})},100)},e.cancel=function(){t.dismiss()}}],size:"md"})}}]),app.controller("TeacherMyCourseCtrl",["$scope","$http","host","SweetAlert","$state",function(e,t,s,n,a){t.get(s+"Teacher/course/selectedCourses").success(function(t){1==t.code&&(e.courses=t.data),0==t.data.length&&$(".table").dataTable()}),e.unselect=function(){var o=getSelectedList().map(function(t){return e.courses[t].id});if(0==o.length)return void n.swal("提示","请选择取消授课的课程","warning");n.swal({title:"提示",text:"是否取消选中的课程！",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(e){e&&t.post(s+"Teacher/course/unselectCourses",{ids:o}).success(function(e){1==e.code?(n.swal("取消授课成功","","success"),a.reload()):n.swal("取消授课失败","","error")})})}}]);
//# sourceMappingURL=bundle.min.js.map

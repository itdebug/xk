"use strict";angular.module("app",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ngStorage","ui.router","ui.bootstrap","oc.lazyLoad","oitozero.ngSweetAlert"]);var app=angular.module("app");function getSelectedList(){var e=[];return $("input[name=list]:checked").each(function(){e.push($(this).val())}),e}app.factory("httpInterceptor",["$q","$injector",function(s,n){return{responseError:function(e){if(401==e.status){var t=n.get("$rootScope");sessionStorage.removeItem("token"),t.$state.go("signin"),$.notify({message:"<div style='text-align: center'><i class='fa fa-warning'></i> 身份验证异常，请重新登录！</div>"},{type:"danger",placement:{align:"center"}})}return s.reject(e)},response:function(e){return e},request:function(e){var t;return(t=sessionStorage.getItem("token"))&&(e.headers.Authorization=t),e},requestError:function(e){return s.reject(e)}}}]),app.config(["$controllerProvider","$compileProvider","$filterProvider","$provide","$locationProvider","$httpProvider",function(e,t,s,n,a,o){app.controller=e.register,app.directive=t.directive,app.filter=s.register,app.factory=n.factory,app.service=n.service,app.constant=n.constant,app.value=n.value,o.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8",o.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8",o.defaults.transformRequest=function(e){return angular.isObject(e)&&"[object File]"!==String(e)?$.param(e):e},o.interceptors.push("httpInterceptor")}]),app.constant("host",""),app.directive("onFinishRenderFilters",["$timeout",function(n){return{restrict:"A",link:function(e,t,s){!0===e.$last&&n(function(){e.$emit("ngRepeatFinished")})}}}]),app.directive("onRepeatFinish",["$timeout",function(n){return{link:function(e,t,s){e.$last&&n(function(){e.$eval(s.onRepeatFinish)})}}}]),app.config(["$provide",function(e){e.decorator("$exceptionHandler",["$delegate",function(s){return function(e,t){s(e,t),setTimeout(function(){throw e})}}])}]),angular.module("app").run(["$rootScope","$state","$stateParams",function(e,t,s){e.$state=t,e.$stateParams=s}]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/signin"),e.state("signin",{controller:"SigninCtrl",url:"/signin",templateUrl:"static/tpl/signin.html"}).state("app",{controller:"GlobalCtrl",url:"/app",templateUrl:"static/tpl/app.html"}).state("app.admin",{url:"/admin",templateUrl:"static/tpl/admin/admin.html"}).state("app.teacher",{url:"/teacher",templateUrl:"static/tpl/teacher/teacher.html"}).state("app.student",{url:"/student",templateUrl:"static/tpl/student/student.html"}).state("app.teacher.allCourse",{controller:"TeacherAllCourseCtrl",url:"/allCourse",templateUrl:"static/tpl/teacher/all-course.html"}).state("app.teacher.myCourse",{controller:"TeacherMyCourseCtrl",url:"/myCourse",templateUrl:"static/tpl/teacher/my-course.html"}).state("app.student.allCourse",{controller:"StudentAllCourseCtrl",url:"/allCourse",templateUrl:"static/tpl/student/all-course.html"}).state("app.student.myCourse",{controller:"StudentMyCourseCtrl",url:"/myCourse",templateUrl:"static/tpl/student/my-course.html"}).state("app.admin.dept",{controller:"DeptCtrl",url:"/dept",templateUrl:"static/tpl/admin/dept.html"}).state("app.admin.class",{controller:"ClassCtrl",url:"/class",templateUrl:"static/tpl/admin/class.html"}).state("app.admin.teacher",{controller:"TeacherManageCtrl",url:"/teacher",templateUrl:"static/tpl/admin/teacher.html"}).state("app.admin.student",{controller:"StudentManageCtrl",url:"/student",templateUrl:"static/tpl/admin/student.html"}).state("app.admin.course",{controller:"CourseManageCtrl",url:"/course",templateUrl:"static/tpl/admin/course.html"}).state("app.admin.password",{controller:"ChangePwdCtrl",url:"/password",templateUrl:"static/tpl/common/change-pwd.html"}).state("app.teacher.password",{controller:"ChangePwdCtrl",url:"/password",templateUrl:"static/tpl/common/change-pwd.html"}).state("app.student.password",{controller:"ChangePwdCtrl",url:"/password",templateUrl:"static/tpl/common/change-pwd.html"}).state("app.teacher.grade",{controller:"RecordGradeCtrl",url:"/recordGrade/:cid",templateUrl:"static/tpl/teacher/grade.html"}).state("app.student.grade",{controller:"QueryGradeCtrl",url:"/queryGrade/:cid",templateUrl:"static/tpl/student/grade.html"})}]),app.controller("AppCtrl",["$scope","$state",function(e,o){e.app={name:"中国最强-选课管理系统 "},e.$on("$stateChangeStart",function(e,t,s,n,a){"signin"===t.name||sessionStorage.getItem("token")||(e.preventDefault(),o.go("signin"))})}]),app.controller("ChangePwdCtrl",["$scope","$http","host","$timeout","SweetAlert","$state",function(t,e,s,n,a,o){t.submit=function(){t.check=!0,n(function(){0<$("form .has-error").length||e.post(s+"Access/changePwd",{newPwd:t.password,oldPwd:t.oldPwd}).success(function(e){1==e.code?(t.logout(),a.swal("修改成功","修改密码成功，请重新登录。","success"),o.go("signin")):a.swal("修改失败",e.msg,"error")})},100)}}]),app.controller("ClassCtrl",["$scope","$modal","$http","host","$state","SweetAlert","$timeout",function(n,a,o,c,r,l,e){var i=[];o.get(c+"Admin/dept/getAll").success(function(e){1==e.code&&(i=e.data,n.deptMap={},e.data.map(function(e){n.deptMap[e.id]=e.name}))}),o.get(c+"Admin/class/getAll").success(function(e){1==e.code&&(n.classes=e.data),0==e.data.length&&$(".table").dataTable()}),n.add=function(){a.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(t,s){t.depts=i,t.clazz={},t.ok=function(){t.check=!0,e(function(){0<$("form .has-error").length||o.post(c+"Admin/class/add",t.clazz).success(function(e){1==e.code?l.swal("增加成功","新增“"+t.clazz.name+"”","success"):l.swal("增加失败",e.msg,"error"),s.close(),r.reload()})},100)},t.cancel=function(){s.dismiss()}}],size:"md"})},n.del=function(){var t=getSelectedList().map(function(e){return n.classes[e].id});0!=t.length?l.swal({title:"提示",text:"是否确定删除选中的班级？",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(e){e&&o.post(c+"Admin/class/del",{ids:t}).success(function(e){1==e.code?(l.swal("删除成功","成功删除选中的班级","success"),r.reload()):l.swal("删除失败",e.msg,"error")})}):l.swal("提示","请选择删除的班级","warning")},n.edit=function(){var e=getSelectedList();if(1==getSelectedList().length){var t=e[0],s=n.classes[t];a.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(e,t){e.depts=i,e.clazz=s,e.ok=function(){e.check=!0,e.clazz.name&&e.clazz.deptId&&o.post(c+"Admin/class/upd",e.clazz).success(function(e){1==e.code?(l.swal("编辑成功","","success"),r.reload()):l.swal("编辑失败",e.msg,"error"),t.close(),r.reload()})},e.cancel=function(){t.dismiss()}}],size:"md"})}else l.swal("提示","请选择一个编辑的班级","warning")}}]),app.controller("CourseManageCtrl",["$scope","$modal","$http","host","$state","SweetAlert","$timeout",function(n,a,o,c,r,l,i){o.get(c+"Admin/course/getAll").success(function(e){1==e.code&&(n.courses=e.data),0==e.data.length&&$(".table").dataTable()}),n.add=function(){a.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(t,s){t.course={},t.ok=function(){t.check=!0,i(function(){0<$("form .has-error").length||o.post(c+"Admin/course/add",t.course).success(function(e){1==e.code?l.swal("增加成功","新增“"+t.course.name+"”","success"):l.swal("增加失败",e.msg,"error"),s.close(),r.reload()})},100)},t.cancel=function(){s.dismiss()}}],size:"md"})},n.del=function(){var t=getSelectedList().map(function(e){return n.courses[e].id});0!=t.length?l.swal({title:"提示",text:"是否确定删除选中的课程？",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(e){e&&o.post(c+"Admin/course/del",{ids:t}).success(function(e){1==e.code?(l.swal("删除成功","成功删除选中的课程","success"),r.reload()):l.swal("删除失败",e.msg,"error")})}):l.swal("提示","请选择删除的课程","warning")},n.edit=function(){var e=getSelectedList();if(1==getSelectedList().length){var t=e[0],s=n.courses[t];a.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(e,t){e.course=s,e.ok=function(){e.check=!0,i(function(){0<$("form .has-error").length||o.post(c+"Admin/course/upd",e.course).success(function(e){1==e.code?(l.swal("编辑成功","","success"),r.reload()):l.swal("编辑失败",e.msg,"error"),t.close(),r.reload()})},100)},e.cancel=function(){t.dismiss()}}],size:"md"})}else l.swal("提示","请选择一个编辑的课程","warning")}}]),app.controller("DeptCtrl",["$scope","$modal","$http","host","$state","SweetAlert",function(n,a,o,c,r,l){o.get(c+"Admin/dept/getAll").success(function(e){1==e.code&&(n.depts=e.data),0==e.data.length&&$(".table").dataTable()}),n.add=function(){a.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(t,s){t.dept={},t.ok=function(){t.check=!0,t.dept.name&&o.post(c+"Admin/dept/add",t.dept).success(function(e){1==e.code?l.swal("增加成功","新增“"+t.dept.name+"”","success"):l.swal("增加失败",e.msg,"error"),s.close(),r.reload()})},t.cancel=function(){s.dismiss()}}],size:"md"})},n.del=function(){var t=getSelectedList().map(function(e){return n.depts[e].id});0!=t.length?l.swal({title:"提示",text:"是否确定删除选中的院系？",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(e){e&&o.post(c+"Admin/dept/del",{ids:t}).success(function(e){1==e.code?(l.swal("删除成功","成功删除选中的院系","success"),r.reload()):l.swal("删除失败",e.msg,"error")})}):l.swal("提示","请选择删除的院系","warning")},n.edit=function(){var e=getSelectedList();if(1==getSelectedList().length){var t=e[0],s=n.depts[t];a.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(e,t){e.dept=s,e.ok=function(){e.check=!0,e.dept.name&&o.post(c+"Admin/dept/upd",e.dept).success(function(e){1==e.code?(l.swal("编辑成功","","success"),r.reload()):l.swal("编辑失败",e.msg,"error"),t.close(),r.reload()})},e.cancel=function(){t.dismiss()}}],size:"md"})}else l.swal("提示","请选择一个编辑的院系","warning")}}]),app.controller("GlobalCtrl",["$scope","$state",function(e,t){e.reload=function(){t.reload()},e.curState=function(){return t.current.name},e.renderTable=function(){$(".table").dataTable()},e.logout=function(){sessionStorage.removeItem("token"),sessionStorage.removeItem("userID"),sessionStorage.removeItem("role")}}]),app.controller("QueryGradeCtrl",["$scope","$http","host",function(t,e,s){e.get(s+"Student/grade/queryGrade").success(function(e){1==e.code&&(t.gradeMap={},e.data.grades.map(function(e){t.gradeMap[e.cid]=e.grade}),t.courses=e.data.courses.map(function(e){return e.grade=t.gradeMap[e.id],e.grade<45?e.status="重修":e.grade<60?e.status="补考":e.grade<70?e.status="及格":e.grade<85?e.status="良好":e.status="优秀",e})),0==t.courses.length&&$(".table").dataTable()})}]),app.controller("RecordGradeCtrl",["$scope","$stateParams","$http","host","SweetAlert",function(n,e,a,o,c){var r=e.cid;a.get(o+"Teacher/grade/findStudentsByCid?id="+r).success(function(e){1==e.code&&(n.course=e.data.course,n.students=e.data.students),0==n.students.length&&$(".table").dataTable()}),a.get(o+"Teacher/class/getAll").success(function(e){1==e.code&&(n.classesMap={},e.data.map(function(e){n.classesMap[e.id]=e.name}))}),a.get(o+"Teacher/class/getGradeByCid?id="+r).success(function(e){1==e.code&&(n.gradeMap={},e.data.map(function(e){n.gradeMap[e.sid]=e.grade}))}),n.record=function(e,t){var s=$(e.target).val();0!=s.length&&(isNaN(s)||s<1||100<s?$.notify({message:"<i class='fa fa-warning'></i> 请输入1~100的分数！"},{type:"warning"}):a.post(o+"Teacher/grade/recordGrade",{cid:r,sid:t,grade:s}).success(function(e){1==e.code?n.gradeMap[t]=s:c.swal("登记成绩失败",e.msg,"error")}))},n.edit=function(){getSelectedList().map(function(e){n.gradeMap[n.students[e].id]=0})}}]),app.controller("SigninCtrl",["$scope","$state","host","SweetAlert","$http",function(t,s,e,n,a){t.user=localStorage.user?JSON.parse(localStorage.user):{role:"student"},t.submit=function(){a.post(e+"Access/signin",t.user).success(function(e){1==e.code?(sessionStorage.token=e.data.token,"student"==e.data.role?s.go("app.student"):"teacher"==e.data.role?s.go("app.teacher"):"admin"==e.data.role&&s.go("app.admin"),$("#remember").prop("checked")?localStorage.user=JSON.stringify({name:t.user.name,role:t.user.role}):localStorage.removeItem("user"),n.swal("登录成功","欢迎登录，"+e.data.name,"success")):n.swal("登录失败",e.msg,"error")}).error(function(){n.swal("提示","服务器异常","error")})}}]),app.controller("StudentAllCourseCtrl",["$scope","$http","host","SweetAlert",function(s,n,a,o){n.get(a+"Student/course/getAll").success(function(e){1==e.code&&(s.courses=e.data.courses,s.teachers={},s.tc={},e.data.teachers.map(function(e){s.teachers[e.id]=e.name}),e.data.tc.map(function(e){s.tc[e.cid]=e.tid})),0==e.data.courses.length&&$(".table").dataTable()}),s.select=function(){var t=getSelectedList().map(function(e){return s.courses[e].id});0!=t.length?o.swal({title:"提示",text:"请再次确认您的选课信息！",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(e){e&&n.post(a+"Student/course/selectCourses",{ids:t}).success(function(e){1==e.code?o.swal("选课成功","请到“我的选课”中查看您的选课","success"):o.swal("选课失败",e.msg,"error")})}):o.swal("提示","请选择课程","warning")}}]),app.controller("StudentManageCtrl",["$scope","$modal","$http","host","$state","SweetAlert","$timeout",function(n,a,o,c,r,l,i){var d=[];o.get(c+"Admin/dept/getAll").success(function(e){1==e.code&&(d=e.data,n.deptMap={},e.data.map(function(e){n.deptMap[e.id]=e.name}))});var u={};o.get(c+"Admin/class/getAll").success(function(e){1==e.code&&(e.data.map(function(e){u[e.deptId]||(u[e.deptId]=[]),u[e.deptId].push(e)}),n.classesMap={},e.data.map(function(e){n.classesMap[e.id]=e.name}))}),o.get(c+"Admin/student/getAll").success(function(e){1==e.code&&(n.students=e.data),0==e.data.length&&$(".table").dataTable()}),n.add=function(){a.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(t,s){t.depts=d,t.classMap=u,t.student={},t.changeDept=function(){delete t.student.classId},t.ok=function(){t.check=!0,i(function(){0<$("form .has-error").length||o.post(c+"Admin/student/add",t.student).success(function(e){1==e.code?l.swal("增加成功","新增“"+t.student.name+"”","success"):l.swal("增加失败",e.msg,"error"),s.close(),r.reload()})},100)},t.cancel=function(){s.dismiss()}}],size:"md"})},n.del=function(){var t=getSelectedList().map(function(e){return n.students[e].id});0!=t.length?l.swal({title:"提示",text:"是否确定删除选中的学生？",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(e){e&&o.post(c+"Admin/student/del",{ids:t}).success(function(e){1==e.code?(l.swal("删除成功","成功删除选中的学生","success"),r.reload()):l.swal("删除失败",e.msg,"error")})}):l.swal("提示","请选择删除的学生","warning")},n.edit=function(){var e=getSelectedList();if(1==getSelectedList().length){var t=e[0],s=n.students[t];a.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(e,t){e.depts=d,e.classMap=u,e.student=s,delete e.student.password,e.changeDept=function(){delete e.student.classId},e.ok=function(){e.check=!0,i(function(){0<$("form .has-error").length||o.post(c+"Admin/student/upd",e.student).success(function(e){1==e.code?(l.swal("编辑成功","","success"),r.reload()):l.swal("编辑失败",e.msg,"error"),t.close()})},100)},e.cancel=function(){t.dismiss()}}],size:"md"})}else l.swal("提示","请选择一个编辑的学生","warning")}}]),app.controller("StudentMyCourseCtrl",["$scope","$http","host","SweetAlert","$state",function(s,n,a,o,c){n.get(a+"Student/course/selectedCourses").success(function(e){1==e.code&&(s.courses=e.data.courses,s.teachers={},s.tc={},e.data.teachers.map(function(e){s.teachers[e.id]=e.name}),e.data.tc.map(function(e){s.tc[e.cid]=e.tid})),0==e.data.courses.length&&$(".table").dataTable()}),s.unselect=function(){var t=getSelectedList().map(function(e){return s.courses[e].id});0!=t.length?o.swal({title:"提示",text:"是否退选选中的课程！",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(e){e&&n.post(a+"Student/course/unselectCourses",{ids:t}).success(function(e){1==e.code?(o.swal("退选成功","","success"),c.reload()):o.swal("退选失败","","error")})}):o.swal("提示","请选择退选的课程","warning")}}]),app.controller("TeacherAllCourseCtrl",["$scope","$http","host","SweetAlert",function(s,n,a,o){n.get(a+"Teacher/course/getAll").success(function(e){1==e.code&&(s.courses=e.data),0==e.data.length&&$(".table").dataTable()}),s.select=function(){var t=getSelectedList().map(function(e){return s.courses[e].id});0!=t.length?o.swal({title:"提示",text:"请再次确认您的授课信息！",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(e){e&&n.post(a+"Teacher/course/selectCourses",{ids:t}).success(function(e){1==e.code?(o.swal("选择授课成功","请到“我的授课”中查看您的授课","success"),s.reload()):o.swal("选择授课失败",e.msg,"error")})}):o.swal("提示","请选择授课的课程","warning")}}]),app.controller("TeacherManageCtrl",["$scope","$modal","$http","host","$state","SweetAlert","$timeout",function(n,a,o,c,r,l,i){var d=[];o.get(c+"Admin/dept/getAll").success(function(e){1==e.code&&(d=e.data,n.deptMap={},e.data.map(function(e){n.deptMap[e.id]=e.name}))}),o.get(c+"Admin/teacher/getAll").success(function(e){1==e.code&&(n.teachers=e.data),0==e.data.length&&$(".table").dataTable()}),n.add=function(){a.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(t,s){t.depts=d,t.teacher={},t.ok=function(){t.check=!0,i(function(){0<$("form .has-error").length||o.post(c+"Admin/teacher/add",t.teacher).success(function(e){1==e.code?l.swal("增加成功","新增“"+t.teacher.name+"”","success"):l.swal("增加失败",e.msg,"error"),s.close(),r.reload()})},100)},t.cancel=function(){s.dismiss()}}],size:"md"})},n.del=function(){var t=getSelectedList().map(function(e){return n.teachers[e].id});0!=t.length?l.swal({title:"提示",text:"是否确定删除选中的教职工？",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(e){e&&o.post(c+"Admin/teacher/del",{ids:t}).success(function(e){1==e.code?(l.swal("删除成功","成功删除选中的教职工","success"),r.reload()):l.swal("删除失败",e.msg,"error")})}):l.swal("提示","请选择删除的教职工","warning")},n.edit=function(){var e=getSelectedList();if(1==getSelectedList().length){var t=e[0],s=n.teachers[t];a.open({templateUrl:"add.html",controller:["$scope","$modalInstance",function(e,t){e.depts=d,e.teacher=s,delete e.teacher.password,e.ok=function(){e.check=!0,i(function(){0<$("form .has-error").length||o.post(c+"Admin/teacher/upd",e.teacher).success(function(e){1==e.code?(l.swal("编辑成功","","success"),r.reload()):l.swal("编辑失败",e.msg,"error"),t.close()})},100)},e.cancel=function(){t.dismiss()}}],size:"md"})}else l.swal("提示","请选择一个编辑的教职工","warning")}}]),app.controller("TeacherMyCourseCtrl",["$scope","$http","host","SweetAlert","$state",function(s,n,a,o,c){n.get(a+"Teacher/course/selectedCourses").success(function(e){1==e.code&&(s.courses=e.data),0==e.data.length&&$(".table").dataTable()}),s.unselect=function(){var t=getSelectedList().map(function(e){return s.courses[e].id});0!=t.length?o.swal({title:"提示",text:"是否取消选中的课程！",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",closeOnConfirm:!1},function(e){e&&n.post(a+"Teacher/course/unselectCourses",{ids:t}).success(function(e){1==e.code?(o.swal("取消授课成功","","success"),c.reload()):o.swal("取消授课失败","","error")})}):o.swal("提示","请选择取消授课的课程","warning")}}]);
//# sourceMappingURL=bundle.min.js.map
